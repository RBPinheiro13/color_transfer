<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="99,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T9U3">w</span>] = distance2(<span class="var type1" id="S3T8U6">Q_inv</span>,<span class="var type1" id="S4T1U7">img_target</span>,<span class="var type1" id="S5T7U8">A_mean</span>,<span class="var type1" id="S6T3U9">numlabels_target</span>,<span class="var type1" id="S7T2U10">labels_target</span>,<span class="var type1" id="S8T6U11">r_2</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="99,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="99,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T6:U8">[<span class="var type1" id="S9T6U15">i</span>,<span class="var type1" id="S10T6U16">j</span>,<span class="var type1" id="S11T6U17">k</span>] = size(<span class="var type1" id="S4T1U20">img_target</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T12:U13"><span class="var type1" id="S13T12U23">logw</span> = <span class="mxinfo " id="T12:U15">zeros(<span class="mxinfo " id="T6:U16">1</span>,<span class="var type1" id="S6T3U27">numlabels_target</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T9:U18"><span class="var type1" id="S2T9U30">w</span> = <span class="mxinfo " id="T9:U20">zeros(<span class="var type1" id="S6T3U33">numlabels_target</span>,<span class="var type1" id="S9T6U34">i</span>,<span class="var type1" id="S10T6U35">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="99,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T6U38">pos</span> = <span class="mxinfo " id="T4:U25"><span class="mxinfo " id="T6:U26">1</span>:<span class="var type1" id="S9T6U41">i</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="99,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T6U44">pos2</span> = <span class="mxinfo " id="T4:U29"><span class="mxinfo " id="T6:U30">1</span>:<span class="var type1" id="S10T6U47">j</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="99,9" id="srcline9"> 9</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="99,10" id="srcline10">10</a></span><span class="line">        <span class="mxinfo " id="T3:U32"><span class="var type1" id="S17T3U50">aux2</span> = <span class="mxinfo " id="T3:U34"><span class="var type1" id="S7T2U52">labels_target</span>(<span class="var type1" id="S15T6U53">pos</span>,<span class="var type1" id="S16T6U54">pos2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,11" id="srcline11">11</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="99,12" id="srcline12">12</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S18T3U57">aux</span> = <span class="mxinfo " id="T10:U39"><span class="mxinfo " id="T3:U40">1</span>:<span class="var type1" id="S6T3U60">numlabels_target</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="99,13" id="srcline13">13</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="99,14" id="srcline14">14</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T14:U42"><span class="mxinfo " id="T6:U43"><span class="mxinfo " id="T6:U44">(<span class="mxinfo " id="T6:U45"><span class="mxinfo " id="T6:U46"><span class="var type1" id="S15T6U69">pos</span>/<span class="var type1" id="S9T6U70">i</span></span> - <span class="mxinfo " id="T6:U49"><span class="var type1" id="S5T7U72">A_mean</span>(<span class="mxinfo " id="T6:U51">1</span>,<span class="var type1" id="S18T3U74">aux</span>)</span></span>)^2</span>+<span class="mxinfo " id="T6:U53">(<span class="mxinfo " id="T6:U54"><span class="mxinfo " id="T6:U55"><span class="var type1" id="S16T6U80">pos2</span>/<span class="var type1" id="S10T6U81">j</span></span> - <span class="mxinfo " id="T6:U58"><span class="var type1" id="S5T7U83">A_mean</span>(<span class="mxinfo " id="T6:U60">2</span>,<span class="var type1" id="S18T3U85">aux</span>)</span></span>)^2</span></span>&lt;=<span class="var type1" id="S8T6U87">r_2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="99,15" id="srcline15">15</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="99,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T6:U63"><span class="mxinfo " id="T6:U64"><span class="var type1" id="S13T12U91">logw</span>(<span class="var type1" id="S18T3U92">aux</span>)</span> = <span class="mxinfo " id="T6:U67"><span class="mxinfo " id="T26:U68"><span class="mxinfo " id="T26:U69">-<span class="mxinfo " id="T26:U70">(<span class="mxinfo " id="T25:U71"><span class="mxinfo " id="T25:U72">[<span class="mxinfo " id="T6:U73"><span class="var type1" id="S15T6U102">pos</span>/<span class="var type1" id="S9T6U103">i</span></span>; <span class="mxinfo " id="T6:U76"><span class="var type1" id="S16T6U106">pos2</span>/<span class="var type1" id="S10T6U107">j</span></span>; <span class="mxinfo " id="T6:U79"><span class="mxinfo " id="T6:U80"><span class="var type1" id="S4T1U111">img_target</span>(<span class="var type1" id="S15T6U112">pos</span>,<span class="var type1" id="S16T6U113">pos2</span>,<span class="mxinfo " id="T11:U84">1</span>)</span>./<span class="mxinfo " id="T6:U85">255</span></span>; <span class="mxinfo " id="T6:U86"><span class="mxinfo " id="T6:U87"><span class="var type1" id="S4T1U119">img_target</span>(<span class="var type1" id="S15T6U120">pos</span>,<span class="var type1" id="S16T6U121">pos2</span>,<span class="mxinfo " id="T11:U91">2</span>)</span>./<span class="mxinfo " id="T6:U92">255</span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,17" id="srcline17">17</a></span><span class="line">                <span class="mxinfo " id="T6:U93"><span class="mxinfo " id="T6:U94"><span class="var type1" id="S4T1U127">img_target</span>(<span class="var type1" id="S15T6U128">pos</span>,<span class="var type1" id="S16T6U129">pos2</span>,<span class="mxinfo " id="T11:U98">3</span>)</span>./<span class="mxinfo " id="T6:U99">255</span></span>]</span>- <span class="mxinfo " id="T25:U100"><span class="var type1" id="S5T7U133">A_mean</span>(<span class="mxinfo " id="T24:U102">:</span>,<span class="var type1" id="S18T3U135">aux</span>)</span></span>)'</span></span>*<span class="mxinfo " id="T23:U104"><span class="var type1" id="S3T8U137">Q_inv</span>(<span class="mxinfo " id="T24:U106">:</span>,<span class="mxinfo " id="T24:U107">:</span>,<span class="mxinfo " id="T3:U108"><span class="var type1" id="S17T3U141">aux2</span>+<span class="mxinfo " id="T6:U110">1</span></span>)</span></span>* <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,18" id="srcline18">18</a></span><span class="line">                (<span class="mxinfo " id="T25:U111"><span class="mxinfo " id="T25:U112">[<span class="mxinfo " id="T6:U113"><span class="var type1" id="S15T6U148">pos</span>/<span class="var type1" id="S9T6U149">i</span></span>; <span class="mxinfo " id="T6:U116"><span class="var type1" id="S16T6U152">pos2</span>/<span class="var type1" id="S10T6U153">j</span></span>; <span class="mxinfo " id="T6:U119"><span class="mxinfo " id="T6:U120"><span class="var type1" id="S4T1U157">img_target</span>(<span class="var type1" id="S15T6U158">pos</span>,<span class="var type1" id="S16T6U159">pos2</span>,<span class="mxinfo " id="T11:U124">1</span>)</span>./<span class="mxinfo " id="T6:U125">255</span></span>; <span class="mxinfo " id="T6:U126"><span class="mxinfo " id="T6:U127"><span class="var type1" id="S4T1U165">img_target</span>(<span class="var type1" id="S15T6U166">pos</span>,<span class="var type1" id="S16T6U167">pos2</span>,<span class="mxinfo " id="T11:U131">2</span>)</span>./<span class="mxinfo " id="T6:U132">255</span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,19" id="srcline19">19</a></span><span class="line">                <span class="mxinfo " id="T6:U133"><span class="mxinfo " id="T6:U134"><span class="var type1" id="S4T1U173">img_target</span>(<span class="var type1" id="S15T6U174">pos</span>,<span class="var type1" id="S16T6U175">pos2</span>,<span class="mxinfo " id="T11:U138">3</span>)</span>./<span class="mxinfo " id="T6:U139">255</span></span>]</span> - <span class="mxinfo " id="T25:U140"><span class="var type1" id="S5T7U179">A_mean</span>(<span class="mxinfo " id="T24:U142">:</span>,<span class="var type1" id="S18T3U181">aux</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,20" id="srcline20">20</a></span><span class="line">            <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="99,21" id="srcline21">21</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="99,22" id="srcline22">22</a></span><span class="line">                <span class="mxinfo " id="T6:U144"><span class="mxinfo " id="T6:U145"><span class="var type1" id="S13T12U186">logw</span>(<span class="var type1" id="S18T3U187">aux</span>)</span> = <span class="mxinfo " id="T6:U148">-<span class="mxinfo " id="T6:U149">Inf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,24" id="srcline24">24</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="99,25" id="srcline25">25</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T6:U150"><span class="var type1" id="S20T6U193">alpha</span> = <span class="mxinfo " id="T6:U152">min(<span class="mxinfo " id="T12:U153">-<span class="var type1" id="S13T12U197">logw</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,27" id="srcline27">27</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="99,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T4:U155"><span class="mxinfo " id="T4:U156"><span class="var type1" id="S2T9U201">w</span>(<span class="mxinfo " id="T21:U158">:</span>,<span class="var type1" id="S15T6U203">pos</span>,<span class="var type1" id="S16T6U204">pos2</span>)</span> = <span class="mxinfo " id="T12:U161">exp(<span class="mxinfo " id="T12:U162"><span class="var type1" id="S13T12U208">logw</span> + <span class="var type1" id="S20T6U209">alpha</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="99,29" id="srcline29">29</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="99,32" id="srcline32">32</a></span><span class="line"></span></span>
</pre>
