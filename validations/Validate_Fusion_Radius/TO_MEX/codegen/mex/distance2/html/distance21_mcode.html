<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T1U3">w</span>] = distance2(<span class="var type1" id="S3T2U6">Q_inv</span>,<span class="var type1" id="S4T3U7">img_target</span>,<span class="var type1" id="S5T4U8">A_mean</span>,<span class="var type1" id="S6T5U9">numlabels_target</span>,<span class="var type1" id="S7T6U10">labels_target</span>,<span class="var type1" id="S8T7U11">r_2</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="mxinfo " id="T7:U8">[<span class="var type1" id="S9T7U15">i</span>,<span class="var type1" id="S10T7U16">j</span>,<span class="var type1" id="S11T7U17">k</span>] = size(<span class="var type1" id="S4T3U20">img_target</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="mxinfo " id="T8:U13"><span class="var type1" id="S13T8U23">logw</span> = <span class="mxinfo " id="T8:U15">zeros(<span class="mxinfo " id="T7:U16">1</span>,<span class="var type1" id="S6T5U27">numlabels_target</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="mxinfo " id="T1:U18"><span class="var type1" id="S2T1U30">w</span> = <span class="mxinfo " id="T1:U20">zeros(<span class="var type1" id="S6T5U33">numlabels_target</span>,<span class="var type1" id="S9T7U34">i</span>,<span class="var type1" id="S10T7U35">j</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S15T7U38">pos</span> = <span class="mxinfo " id="T7:U25">1</span>:<span class="var type1" id="S9T7U41">i</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line">    <span class="keyword">for</span> <span class="var type1" id="S16T7U44">pos2</span> = <span class="mxinfo " id="T7:U28">1</span>:<span class="var type1" id="S10T7U47">j</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line">        <span class="mxinfo " id="T5:U30"><span class="var type1" id="S17T5U50">aux2</span> = <span class="mxinfo " id="T5:U32"><span class="var type1" id="S7T6U52">labels_target</span>(<span class="var type1" id="S15T7U53">pos</span>,<span class="var type1" id="S16T7U54">pos2</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line">        <span class="keyword">for</span> <span class="var type1" id="S18T5U57">aux</span> = <span class="mxinfo " id="T5:U37">1</span>:<span class="var type1" id="S6T5U60">numlabels_target</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line">            <span class="keyword">if</span> <span class="mxinfo " id="T9:U39"><span class="mxinfo " id="T7:U40"><span class="mxinfo " id="T7:U41">(<span class="mxinfo " id="T7:U42"><span class="mxinfo " id="T7:U43"><span class="var type1" id="S15T7U69">pos</span>/<span class="var type1" id="S9T7U70">i</span></span> - <span class="mxinfo " id="T7:U46"><span class="var type1" id="S5T4U72">A_mean</span>(<span class="mxinfo " id="T7:U48">1</span>,<span class="var type1" id="S18T5U74">aux</span>)</span></span>)^2</span>+<span class="mxinfo " id="T7:U50">(<span class="mxinfo " id="T7:U51"><span class="mxinfo " id="T7:U52"><span class="var type1" id="S16T7U80">pos2</span>/<span class="var type1" id="S10T7U81">j</span></span> - <span class="mxinfo " id="T7:U55"><span class="var type1" id="S5T4U83">A_mean</span>(<span class="mxinfo " id="T7:U57">2</span>,<span class="var type1" id="S18T5U85">aux</span>)</span></span>)^2</span></span>&lt;=<span class="var type1" id="S8T7U87">r_2</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">            <span class="mxinfo " id="T7:U60"><span class="mxinfo " id="T7:U61"><span class="var type1" id="S13T8U91">logw</span>(<span class="var type1" id="S18T5U92">aux</span>)</span> = <span class="mxinfo " id="T7:U64"><span class="mxinfo " id="T10:U65"><span class="mxinfo " id="T10:U66">-<span class="mxinfo " id="T10:U67">(<span class="mxinfo " id="T11:U68"><span class="mxinfo " id="T11:U69">[<span class="mxinfo " id="T7:U70"><span class="var type1" id="S15T7U102">pos</span>/<span class="var type1" id="S9T7U103">i</span></span>; <span class="mxinfo " id="T7:U73"><span class="var type1" id="S16T7U106">pos2</span>/<span class="var type1" id="S10T7U107">j</span></span>; <span class="mxinfo " id="T7:U76"><span class="mxinfo " id="T7:U77"><span class="var type1" id="S4T3U111">img_target</span>(<span class="var type1" id="S15T7U112">pos</span>,<span class="var type1" id="S16T7U113">pos2</span>,<span class="mxinfo " id="T12:U81">1</span>)</span>./<span class="mxinfo " id="T7:U82">255</span></span>; <span class="mxinfo " id="T7:U83"><span class="mxinfo " id="T7:U84"><span class="var type1" id="S4T3U119">img_target</span>(<span class="var type1" id="S15T7U120">pos</span>,<span class="var type1" id="S16T7U121">pos2</span>,<span class="mxinfo " id="T12:U88">2</span>)</span>./<span class="mxinfo " id="T7:U89">255</span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line">                <span class="mxinfo " id="T7:U90"><span class="mxinfo " id="T7:U91"><span class="var type1" id="S4T3U127">img_target</span>(<span class="var type1" id="S15T7U128">pos</span>,<span class="var type1" id="S16T7U129">pos2</span>,<span class="mxinfo " id="T12:U95">3</span>)</span>./<span class="mxinfo " id="T7:U96">255</span></span>]</span>- <span class="mxinfo " id="T11:U97"><span class="var type1" id="S5T4U133">A_mean</span>(<span class="mxinfo " id="T13:U99">:</span>,<span class="var type1" id="S18T5U135">aux</span>)</span></span>)'</span></span>*<span class="mxinfo " id="T14:U101"><span class="var type1" id="S3T2U137">Q_inv</span>(<span class="mxinfo " id="T13:U103">:</span>,<span class="mxinfo " id="T13:U104">:</span>,<span class="mxinfo " id="T5:U105"><span class="var type1" id="S17T5U141">aux2</span>+<span class="mxinfo " id="T7:U107">1</span></span>)</span></span>* <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line">                (<span class="mxinfo " id="T11:U108"><span class="mxinfo " id="T11:U109">[<span class="mxinfo " id="T7:U110"><span class="var type1" id="S15T7U148">pos</span>/<span class="var type1" id="S9T7U149">i</span></span>; <span class="mxinfo " id="T7:U113"><span class="var type1" id="S16T7U152">pos2</span>/<span class="var type1" id="S10T7U153">j</span></span>; <span class="mxinfo " id="T7:U116"><span class="mxinfo " id="T7:U117"><span class="var type1" id="S4T3U157">img_target</span>(<span class="var type1" id="S15T7U158">pos</span>,<span class="var type1" id="S16T7U159">pos2</span>,<span class="mxinfo " id="T12:U121">1</span>)</span>./<span class="mxinfo " id="T7:U122">255</span></span>; <span class="mxinfo " id="T7:U123"><span class="mxinfo " id="T7:U124"><span class="var type1" id="S4T3U165">img_target</span>(<span class="var type1" id="S15T7U166">pos</span>,<span class="var type1" id="S16T7U167">pos2</span>,<span class="mxinfo " id="T12:U128">2</span>)</span>./<span class="mxinfo " id="T7:U129">255</span></span>; <span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line">                <span class="mxinfo " id="T7:U130"><span class="mxinfo " id="T7:U131"><span class="var type1" id="S4T3U173">img_target</span>(<span class="var type1" id="S15T7U174">pos</span>,<span class="var type1" id="S16T7U175">pos2</span>,<span class="mxinfo " id="T12:U135">3</span>)</span>./<span class="mxinfo " id="T7:U136">255</span></span>]</span> - <span class="mxinfo " id="T11:U137"><span class="var type1" id="S5T4U179">A_mean</span>(<span class="mxinfo " id="T13:U139">:</span>,<span class="var type1" id="S18T5U181">aux</span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line">            <span class="keyword">else</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line">                <span class="mxinfo " id="T7:U141"><span class="mxinfo " id="T7:U142"><span class="var type1" id="S13T8U186">logw</span>(<span class="var type1" id="S18T5U187">aux</span>)</span> = <span class="mxinfo " id="T7:U145">-<span class="mxinfo " id="T7:U146">Inf</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line">            </span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line">        <span class="mxinfo " id="T7:U147"><span class="var type1" id="S20T7U193">alpha</span> = <span class="mxinfo " id="T7:U149">min(<span class="mxinfo " id="T8:U150">-<span class="var type1" id="S13T8U197">logw</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line">        <span class="mxinfo " id="T15:U152"><span class="mxinfo " id="T15:U153"><span class="var type1" id="S2T1U201">w</span>(<span class="mxinfo " id="T16:U155">:</span>,<span class="var type1" id="S15T7U203">pos</span>,<span class="var type1" id="S16T7U204">pos2</span>)</span> = <span class="mxinfo " id="T8:U158">exp(<span class="mxinfo " id="T8:U159"><span class="var type1" id="S13T8U208">logw</span> + <span class="var type1" id="S20T7U209">alpha</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"></span></span>
</pre>
